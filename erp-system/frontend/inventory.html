<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>庫存管理 - ERP 系統</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <link href="style.css" rel="stylesheet">
</head>
<body>
    <div class="sidebar">
        <div class="sidebar-header"><h4><i class="bi bi-grid-3x3-gap-fill"></i> ERP 系統</h4><p>企業資源規劃管理平台</p></div>
        <ul class="nav-menu">
            <li class="nav-item"><a href="index.html" class="nav-link"><i class="bi bi-speedometer2"></i><span>儀表板</span></a></li>
            <li class="nav-item"><a href="orders.html" class="nav-link"><i class="bi bi-cart-check-fill"></i><span>訂單管理</span></a></li>
            <li class="nav-item"><a href="inventory.html" class="nav-link active"><i class="bi bi-box-seam-fill"></i><span>庫存管理</span></a></li>
            <li class="nav-item"><a href="reports.html" class="nav-link"><i class="bi bi-graph-up-arrow"></i><span>數據報表</span></a></li>
        </ul>
        <div style="position: absolute; bottom: 30px; left: 20px; right: 20px;"><div class="ai-badge"><i class="bi bi-stars"></i> AI Agent 已啟用</div></div>
    </div>
    <div class="main-content">
        <div class="top-navbar"><h2><i class="bi bi-box-seam-fill"></i> 庫存管理</h2><div class="user-info"><span>系統管理員</span><div class="user-avatar">A</div></div></div>
        <div class="content-wrapper">
            <div class="card"><div class="card-header bg-warning"><i class="bi bi-exclamation-triangle-fill"></i> 庫存預警</div><div class="card-body" id="stockAlerts"><div class="text-center"><div class="spinner-border text-warning"></div></div></div></div>
            <div class="card"><div class="card-header"><i class="bi bi-box-seam"></i> 產品庫存列表</div><div class="card-body"><div class="table-responsive"><table class="table"><thead><tr><th>SKU</th><th>產品名稱</th><th>類別</th><th>單價</th><th>當前庫存</th><th>最低庫存</th><th>供應商</th><th>狀態</th><th>操作</th></tr></thead><tbody id="inventoryTableBody"><tr><td colspan="9" class="text-center"><div class="spinner-border text-primary"></div></td></tr></tbody></table></div></div></div>
        </div>
    </div>
    <div class="modal fade" id="restockModal" tabindex="-1"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h5 class="modal-title"><i class="bi bi-plus-circle"></i> 產品補貨</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><p><strong>產品：</strong><span id="restockProductName"></span></p><p><strong>當前庫存：</strong><span id="restockCurrentStock"></span></p><div class="mb-3"><label class="form-label">補貨數量</label><input type="number" class="form-control" id="restockQuantity" min="1" value="50"></div></div><div class="modal-footer"><button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button><button type="button" class="btn btn-primary" onclick="confirmRestock()">確認補貨</button></div></div></div></div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="ai-widget.js"></script>
    <script>const API_BASE='/api';let currentRestockProduct=null;async function loadStockAlerts(){try{const response=await fetch(API_BASE+'/inventory/alerts');const alerts=await response.json();const container=document.getElementById('stockAlerts');if(alerts.length===0){container.innerHTML='<p class="text-success"><i class="bi bi-check-circle"></i> 所有產品庫存充足</p>';return}let html='<div class="row">';alerts.forEach(alert=>{html+='<div class="col-md-6 mb-3"><div class="alert alert-warning mb-0"><h6><strong>'+alert.product_name+'</strong></h6><p class="mb-0">當前庫存: '+alert.current_stock+' | 最低庫存: '+alert.min_stock_level+' | 缺貨: '+alert.shortage+'</p></div></div>'});html+='</div>';container.innerHTML=html}catch(error){document.getElementById('stockAlerts').innerHTML='<p class="text-danger">載入失敗</p>'}}async function loadInventory(){try{const response=await fetch(API_BASE+'/products');const products=await response.json();const tbody=document.getElementById('inventoryTableBody');tbody.innerHTML='';products.forEach(product=>{let statusClass='stock-normal';let statusText='正常';if(product.stock_quantity===0){statusClass='stock-out';statusText='缺貨'}else if(product.stock_quantity<product.min_stock_level){statusClass='stock-low';statusText='偏低'}const tr=document.createElement('tr');tr.innerHTML='<td><code>'+(product.sku||'-')+'</code></td><td><strong>'+product.name+'</strong></td><td><span class="badge badge-info">'+(product.category||'-')+'</span></td><td>¥'+product.price.toFixed(2)+'</td><td><strong>'+product.stock_quantity+'</strong></td><td>'+product.min_stock_level+'</td><td>'+(product.supplier||'-')+'</td><td><span class="stock-status '+statusClass+'">'+statusText+'</span></td><td><button class="btn btn-sm btn-warning" onclick="showRestockModal('+product.id+',\''+product.name.replace(/'/g,"\\'")+'\''+','+product.stock_quantity+')"><i class="bi bi-plus-circle"></i> 補貨</button></td>';tbody.appendChild(tr)})}catch(error){document.getElementById('inventoryTableBody').innerHTML='<tr><td colspan="9" class="text-center text-danger">載入失敗</td></tr>'}}function showRestockModal(productId,productName,currentStock){currentRestockProduct=productId;document.getElementById('restockProductName').textContent=productName;document.getElementById('restockCurrentStock').textContent=currentStock;document.getElementById('restockQuantity').value=50;new bootstrap.Modal(document.getElementById('restockModal')).show()}async function confirmRestock(){const quantity=parseInt(document.getElementById('restockQuantity').value);if(!quantity||quantity<=0){alert('請輸入有效的補貨數量');return}try{const response=await fetch(API_BASE+'/inventory/restock/'+currentRestockProduct+'?quantity='+quantity,{method:'POST'});if(response.ok){alert('補貨成功！');bootstrap.Modal.getInstance(document.getElementById('restockModal')).hide();loadInventory();loadStockAlerts()}else{alert('補貨失敗')}}catch(error){alert('補貨失敗: '+error.message)}}loadStockAlerts();loadInventory()</script>
</body>
</html>
