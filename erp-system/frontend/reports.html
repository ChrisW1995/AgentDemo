<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>數據報表 - ERP 系統</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <link href="style.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>
<body>
    <div class="sidebar">
        <div class="sidebar-header"><h4><i class="bi bi-grid-3x3-gap-fill"></i> ERP 系統</h4><p>企業資源規劃管理平台</p></div>
        <ul class="nav-menu">
            <li class="nav-item"><a href="index.html" class="nav-link"><i class="bi bi-speedometer2"></i><span>儀表板</span></a></li>
            <li class="nav-item"><a href="orders.html" class="nav-link"><i class="bi bi-cart-check-fill"></i><span>訂單管理</span></a></li>
            <li class="nav-item"><a href="inventory.html" class="nav-link"><i class="bi bi-box-seam-fill"></i><span>庫存管理</span></a></li>
            <li class="nav-item"><a href="reports.html" class="nav-link active"><i class="bi bi-graph-up-arrow"></i><span>數據報表</span></a></li>
        </ul>
        <div style="position: absolute; bottom: 30px; left: 20px; right: 20px;"><div class="ai-badge"><i class="bi bi-stars"></i> AI Agent 已啟用</div></div>
    </div>
    <div class="main-content">
        <div class="top-navbar"><h2><i class="bi bi-graph-up-arrow"></i> 數據報表</h2><div class="user-info"><span>系統管理員</span><div class="user-avatar">A</div></div></div>
        <div class="content-wrapper">
            <h4 class="mb-3"><i class="bi bi-cash-stack"></i> 銷售報表</h4>
            <div class="stats-row" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:20px;margin-bottom:30px">
                <div class="stat-card"><div class="stat-label">總訂單數</div><div class="stat-value" id="totalOrders">-</div></div>
                <div class="stat-card success"><div class="stat-label">總收入</div><div class="stat-value" id="totalRevenue">-</div></div>
                <div class="stat-card" style="border-left-color:#4facfe"><div class="stat-label">已完成訂單</div><div class="stat-value" id="completedOrders">-</div></div>
                <div class="stat-card" style="border-left-color:#43e97b"><div class="stat-label">待處理訂單</div><div class="stat-value" id="pendingOrders">-</div></div>
                <div class="stat-card danger"><div class="stat-label">已取消訂單</div><div class="stat-value" id="cancelledOrders">-</div></div>
            </div>
            <div class="card mb-4"><div class="card-header"><i class="bi bi-trophy-fill"></i> 熱銷產品 TOP 5</div><div class="card-body"><div class="table-responsive"><table class="table"><thead><tr><th>排名</th><th>產品名稱</th><th>銷售數量</th><th>銷售額</th></tr></thead><tbody id="topProductsTable"><tr><td colspan="4" class="text-center"><div class="spinner-border text-primary"></div></td></tr></tbody></table></div></div></div>
            <h4 class="mb-3 mt-4"><i class="bi bi-box-seam"></i> 庫存報表</h4>
            <div class="stats-row" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:20px;margin-bottom:30px">
                <div class="stat-card"><div class="stat-label">產品總數</div><div class="stat-value" id="totalProducts">-</div></div>
                <div class="stat-card success"><div class="stat-label">庫存總價值</div><div class="stat-value" id="totalStockValue">-</div></div>
                <div class="stat-card danger"><div class="stat-label">缺貨產品數</div><div class="stat-value" id="outOfStockCount">-</div></div>
            </div>
            <div class="card"><div class="card-header bg-warning"><i class="bi bi-exclamation-triangle-fill"></i> 低庫存產品</div><div class="card-body"><div id="lowStockProducts"><div class="text-center"><div class="spinner-border text-warning"></div></div></div></div></div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="ai-widget.js"></script>
    <script>const API_BASE='/api';async function loadSalesReport(){try{const response=await fetch(API_BASE+'/reports/sales');const report=await response.json();document.getElementById('totalOrders').textContent=report.total_orders;document.getElementById('totalRevenue').textContent='¥'+report.total_revenue.toLocaleString('zh-TW',{minimumFractionDigits:0});document.getElementById('completedOrders').textContent=report.completed_orders;document.getElementById('pendingOrders').textContent=report.pending_orders;document.getElementById('cancelledOrders').textContent=report.cancelled_orders;const tbody=document.getElementById('topProductsTable');tbody.innerHTML='';if(report.top_products&&report.top_products.length>0){report.top_products.forEach((product,index)=>{const tr=document.createElement('tr');tr.innerHTML='<td><strong>#'+(index+1)+'</strong></td><td>'+product.product_name+'</td><td>'+product.quantity+'</td><td><strong>¥'+product.revenue.toFixed(2)+'</strong></td>';tbody.appendChild(tr)})}else{tbody.innerHTML='<tr><td colspan="4" class="text-center text-muted">暫無銷售數據</td></tr>'}}catch(error){console.error('載入銷售報表失敗:',error)}}async function loadInventoryReport(){try{const response=await fetch(API_BASE+'/reports/inventory');const report=await response.json();document.getElementById('totalProducts').textContent=report.total_products;document.getElementById('totalStockValue').textContent='¥'+report.total_stock_value.toLocaleString('zh-TW',{minimumFractionDigits:0});document.getElementById('outOfStockCount').textContent=report.out_of_stock_count;const container=document.getElementById('lowStockProducts');if(report.low_stock_products&&report.low_stock_products.length>0){let html='<ul class="list-group">';report.low_stock_products.forEach(product=>{html+='<li class="list-group-item d-flex justify-content-between align-items-center"><div><strong>'+product.product_name+'</strong><br><small class="text-muted">當前庫存: '+product.current_stock+' | 最低庫存: '+product.min_stock_level+'</small></div><span class="badge bg-warning">缺貨: '+product.shortage+'</span></li>'});html+='</ul>';container.innerHTML=html}else{container.innerHTML='<p class="text-success"><i class="bi bi-check-circle"></i> 所有產品庫存充足</p>'}}catch(error){console.error('載入庫存報表失敗:',error)}}loadSalesReport();loadInventoryReport()</script>
</body>
</html>
